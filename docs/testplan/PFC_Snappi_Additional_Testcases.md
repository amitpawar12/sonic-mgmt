This document describes the list of additional system testcases.

- [Background](#background)
- [Setup](#setup)
- [Testcases](#testcases)
- [Additional PFC testcases with Port-channels](#Additional PFC testcases with Port-channels)


### Background

Intent of these testcases is to test throughput at the interface speed, PFC, PFC-WD, ECN congestion, port-channels and MACSEC. These testcases will be executed for 100 and 400Gbps ports on single line-card single asic, single line-card multiple asic and multiple line-card. The packet-size will vary from 128 to 1400 bytes.

Test cases are specifically meant for Multi-ASIC, DNX based chassis platform.

Traffic pattern includes at least one lossless priority flow and with/without lossy background traffic. Some of the testcases use pause flows to simulate congestion.

Additionally, the testcases also intend to capture the utilization, packet-drops and/or latency.


### Setup
                                    ________________
                                    |               |
    IXIA(100/400Gbps) <--------->   |    DUT-LC1    |<---------> IXIA(100/400Gbps)
    IXIA(100/400Gbps) <--------->   |    ASIC0      |<---------> IXIA(100/400Gbps)
                                    |_______________|
                                    |_______________|
                                    |               |
    IXIA(100/400Gbps) <--------->   |    DUT-LC1    |<---------> IXIA(100/400Gbps)
    IXIA(100/400Gbps) <--------->   |    ASIC1      |<---------> IXIA(100/400Gbps)
                                    |_______________|

There will be similar setup on a different line-card in the same chassis. IXIA ports will be mix of 100 and 400Gbps.

### Testcases

| Test case ID | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Topology                                                                                                                                                                                   | Traffic Pattern and Settings                                                                                                                                                                                                                                                     | LC combination                                                                   | Pass-Fail Criteria                                                                                                                                                                                                                                                                                                                                                                                         |  
|-------------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           01 | TEST TO DETECT CONGESTION WITH MISMATCHED INGRESS AND EGRESS:<br>Test to verify that with single 400Gbps ingress and 100Gbps egress:<br>- Traffic is sent at line-rate.<br>- No losses are seen for any prio's.<br>- PFCs are sent from the DUT for Lossless Prios to rate-limit PRIO3 and PRIO4 traffic.                                                                                                                                                                                                                                                                                     | - Single 400Gbps Ingress and single 100Gbps egress <br>- 1024B packet-size                                                                                                                 | - 90% of 400Gbps - Lossless Prio3 & Prio4<br>- 10% of 400Gbps - Lossy Background Flow [Prio0, 1, and 2]<br>- Enable pfcwd and credit-watchdog on ingress and egress.                                                                                                             | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. The single 100Gbps egress should see 100Gbps lossy+lossless traffic<br>2. The 40Gbps lossy traffic should be continue to flow.<br>3. The traffic transmitter port should be receiving PFCs for the lossless priority traffic.<br>4. On receiving the PFCs, the IXIA-ingress should reduce the lossless traffic to around 60Gbps.<br>5. No drop for lossy and lossless traffic.                          |
|           02 | NO CONGESTION AT LINE RATE TEST:<br>Test to verify that with single same speed ingress and egress:<br>- Traffic is sent at line-rate.<br>- No losses are seen for any prio's.<br>- No PFCs are sent from the DUT.<br>                                                                                                                                                                                                                                                                                                                                                                         | - Single 100Gbps Ingress and egress <br>- Repeat with 400Gbps ingress and egress port <br>- 128, 256, 512, 1024, 1240 and 1400B packet-size                                                | - 90% of ingress interface speed - Lossless Prio3 & Prio4<br>- 10% of ingress interface speed - Lossy Background Flow [Prio0, 1, and 2]<br>- Enable pfcwd and credit-watchdog on ingress and egress.                                                                             | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. There should be NO packet drops on the DUT (Tool Tx packets == Tool Rx packets) <br>2. There should no PFCs on tool Tx port or on the DUT. <br>3. Measure latency of the packets traversing the DUT. <br>4. Expected throughput of linerate on the egress port of DUT.                                                                                                                                  |
|           03 | PFCWD ENABLED DROP MODE TEST:<br>Test to verify that with two same speed ingress and single egress, PFCWD set to DROP and PFCs on the DUT egress:<br>- DUT detects storm and marks the egress port as "STORMED".<br>- DUT drops the lossless traffic and increments PFCWD counter.<br>- No losses are seen for lossy traffic.<br>- DUT does not send PFCs to the traffic transmitter.                                                                                                                                                                                                         | - Two 100Gbps Ingress and single 100Gbps egress <br>- Repeat test with 2x400Gbps ingress and 1x400Gbps egress <br>- 1024B packet-size                                                      | - 30% - Lossless Prio3 & Prio4 per ingress LC <br>- 10% Lossy Background Flow [Prio0, 1, and 2] per ingress LC. <br>- Enable PFCWD with "action" set to DROP(default)<br>- Send continuous PFC for lossless Priorities for configured interval.                                  | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. No lossy background flows dropped on DUT when the PFC is sent to DUT egress. Egress port is in 'stormed' mode. <br>2. Lossless flows are dropped on DUT. <br>3. PFCWD drop counter should increment. <br> 4. No PFCs are sent from DUT ingress to traffic transmitter. <br>5. After the PFC packets are stopped, the egress port is moves to "operational state" and storm-restored counter increments. |           
|           04 | PFCWD ENABLED FORWARD MODE TEST:<br>Test to verify that with two same speed ingress and single egress, PFCWD set to FORWARD and PFCs on the DUT egress:<br>- DUT detects storm and marks the egress port as "STORMED".<br>- DUT forwards the lossless traffic and increments PFCWD counter.<br>- No losses are seen for lossy traffic.<br>- DUT does not send PFCs to the traffic transmitter.                                                                                                                                                                                                | - Two 100Gbps Ingress and single 100Gbps egress <br>- Repeat test with 2x400Gbps ingress and 1x400Gbps egress <br>- 1024B packet-size                                                      | - 30% - Lossless Prio3 & Prio4 per ingress LC <br>- 10% Lossy Background Flow [Prio0, 1, and 2] per ingress LC. <br>- Enable PFCWD with "action" set to FORWARD <br>- Send continuous PFC for lossless Priorities for configured interval.                                       | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. There should be no packet drops on DUT for lossy background flows. <br>2. The Prio3 and prio4 packets are forwarded to the Traffic Receiver. <br>3. After the PFC packets are stopped, the lossless PRIO traffic should continue without any drops.<br>4. No PFCs sent from DUT ingress to traffic transmitter. <br>5. PFCWD drop counters should not increment.                                        |         
|           05 | EQUAL PRIO TRAFFIC DUT EXPERIENCING CONGESTION BEHAVIOR:<br>Test case to check the amount of the lossless traffic being rate-limited and lossy traffic dropped when egress port is congested:<br>- Equal amount of lossless and lossy priorities from 2 ingress ports.<br>- DUT detects congestion on single egress ports.<br>- Note the % of loss for the lossy traffic.<br>- DUT should send PFCs to the traffic generator and rate-limit lossless priority traffic.<br>- No drop for Lossless priority traffic.                                                                            | - Two 100Gbps Ingress and single 100Gbps egress <br>- Repeat test with 2x400Gbps ingress and 1x400Gbps egress <br>- 1024B packet-size <br>- Equal traffic for all priorities               | - 24% -  Prio3 & Prio4 per ingress LC <br>- 36% Background flows [Prio0, 1, and 2] per ingress LC <br>- 1024B packet-size <br>- Enabled PFCWD and credit-watchdog on ingress and egress.                                                                                         | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. Packet drops for Lossy Traffic. <br>2. PFCs for lossless traffic. No packet drops for losslesss traffic. <br>3. Expected throughput of egress interface line-rate (Lossless + lossy traffic only) on egress interface of DUT. <br>4. Expected close to equal throughput for all priorities.                                                                                                             |          
|           06 | TEST TO DETERMINE LOSSLESS TRAFFIC RATE WITH REAL-LIFE TRAFFIC PATTERN - 90% LOSSLESS and 10% LOSSY:<br>Test case to check the amount of the lossless traffic being rate-limited and lossy traffic is NOT dropped when egress port is congested:<br>- Unequal amount of lossless and lossy priorities from 2 ingress ports.<br>- DUT detects congestion on single egress ports.<br>- Note the rate-limited traffic speed on lossless prio.<br>- DUT should send PFCs to the traffic generator and rate-limit lossless priority traffic.<br>- No drop for Lossless and lossy priority traffic. | - Two 100Gbps Ingress and single 100Gbps egress <br>- Repeat test with 2x400Gbps ingress and 1x400Gbps egress <br>- 1024B packet-size <br>- Unequal traffic lossy and lossless priorities. | - 90% - Lossless Prio3 & Prio4 per ingress LC <br>- 10% - Lossy Background Flow [Prio0, 1, and 2] per ingress LC.                                                                                                                                                                | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. No packet drops for Lossy Traffic. <br>2. PFCs for lossless traffic sent from DUT ingress to traffic transmitter. No packet drops for losslesss traffic. <br>3. Expected throughput of (Lossless + lossy traffic only) on egress interface line rate of DUT.                                                                                                                                            |
|           07 | TEST LINE-RATE OVER MACSEC ENABLED LINK:<br>Testcases to check <br>- if traffic can be sent at line-rate over MACSEC enabled link.                                                                                                                                                                                                                                                                                                                                                                                                                                                            | - Single 100Gbps Ingress and single 100Gbps egress - MACSEC <br>- Repeat with Single 400Gbps ingress and Single 400Gbps egress - MACSEC. <br> - 1024B packet-size.                         | - 90% - Lossless Prio3 & Prio4<br>- 10% - Lossy Background Flow [Prio0, 1, and 2]                                                                                                                                                                                                | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. There should be NO packet drops on the DUT (IXIA Tx packets == IXIA Rx packets) <br>2. There should no PFCs on IXIA Tx port or on the DUT.<br>3. Measure latency of the packets traversing the DUT. <br>4. Expected throughput of linerate on the egress port of DUT.                                                                                                                                   |         
|           08 | TEST CONGESTION DETECTION WITH PAUSE FRAMES OVER MACSEC ENABLED LINK:<br>Testcases to check <br>- behavior when PFCWD is set to disabled with PAUSE frames on DUT egress.                                                                                                                                                                                                                                                                                                                                                                                                                     | - Single 100Gbps Ingress and single 100Gbps egress - PFC over MACSEC <br>- Repeat with Single 400Gbps ingress and Single 400Gbps egress. <br> - 1024B packet-size.                         | - 90% - Lossless Prio3 & Prio4<br>- 10% - Lossy Background Flow [Prio0, 1, and 2] <br>3. Disable PFCWD before the test. <br>4. Send pause to the egress interface of the DUT.                                                                                                    | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. There should be NO packet drops on the DUT (IXIA Tx packets == IXIA Rx packets) <br>2. There should be PFCs on IXIA and DUT - Tx and Rx port.<br>3. The PFCs from IXIA-Rx should stop IXIA-Tx from sending any traffic. <br>4. Only 10% of lossy traffic on the DUT. <br>5. No loss for lossless traffic.                                                                                               |         
|           09 | TEST PFCWD BEHAVIOR OVER MACSEC ENABLED LINK:<br>Testcases to check <br>- behavior when PFCWD is set to enabled in DROP mode and PAUSE frames on DUT egress.                                                                                                                                                                                                                                                                                                                                                                                                                                  | - Single 100Gbps Ingress and single 100Gbps egress - PFCWD(Drop) over MACSEC <br>- Repeat with Single 400Gbps ingress and Single 400Gbps egress. <br> - 1024B packet-size.                 | - 90% - Lossless Prio3 & Prio4<br>- 10% - Lossy Background Flow [Prio0, 1, and 2] <br>3. Enabled PFCWD in default mode before the test. <br>4. Send pause to the egress interface of DUT from IXIA Rx.                                                                           | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. There should be packet drops on the DUT (IXIA Tx packets > IXIA Rx packets). <br>2. There should PFCs on DUT egress but no PFC sent from DUT ingress to traffic transmitter. <br>3. Only 10% of lossy traffic should flow. <br>4. PFCWD drop counter should increment <br>5. DUT Rx port should be in 'stormed' mode.                                                                                                                   |         
|           10 | APPROPRIATE ECN MARKING ON CONGESTION RESTORATION:<br>Test case to verify that packets are correctly ECN marked on congestion detection and restoration.                                                                                                                                                                                                                                                                                                                                                                                                                                      | - Single 100Gbs ingress and single 100Gbps egress <br>- Repeat with 400Gbps ingress and egress. <br>- 1024B packet-size <br>- ECN congestion and packet-marking test.<br>                  | - Disable PFCWD <br>- 90% - Lossless Prio3 & Prio4<br>- 10% - Lossy Background Flow [Prio0, 1, and 2] <br>- Send PFC storm to the egress implying ECN congestion. <br>- Stop the PFC storm. <br>- Monitor set of packets to ensure packets are ECN-marked.                       | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. PFC storm should stop the packets coming DUT ingress. <br>2. No packets going out of egress port during storm. <br>3. The captured packet on egress, once storm is stopped should be ECN-marked.                                                                                                                                                                                                        |         
|           11 | TEST CONGESTION OVER MISMATCHED INGRESS AND EGRESS MACSEC ENABLED LINK:<br>Test case to check if the DUT detects congestion due to mismatched MACSEC enabled link speeds and sends PFCs to rate-limit the lossless priority traffic.           | - Single 400Gbps Ingress and single 100Gbps egress - PFC over MACSEC                                                                                                                        | - 90% - ingress line rate Prio3 & Prio4 <br>- 10% of ingress line-rate -- Background Flow[Prio0, 1, and 2]                                                                                                                                                          | - Single LC - Multiple ASIC <br>- Multiple LC  | 1. There should be NO packet drops on the DUT for both Lossless and lossy priority traffic.<br>2. DUT should PFCs to the traffic generator to rate-limit the lossless priority traffic.<br>3. 100Gbps Egress port should receive Lossless Prio3 and Prio4 traffic.                                                                                                                                                                                                                            |

### Additional PFC testcases with Port-channels:
| Test case ID | Description                                                                                                                                                                                                                                    | Topology                                                                                                                                                                                    | Traffic Pattern and Settings                                                                                                                                                                                                                                        | LC combination                                 | Pass-Fail Criteria                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  
|-------------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           01 | UNEQUAL SPEED INGRESS-EGRESS PORTCHANNEL CONGESTION TEST:<br>Test case to check that DUT detects congestion due to mismatched ingress and egress port-channel speeds and send PFCs to the ingress to rate-limit the lossless priority traffic. | - Port-channel - N x 100Gbps Ingress - 400Gbps Egress with N > 4. <br>- 1024B packet-size.                                                                                                  | - 90% of total ingress port-channel link- Prio3 & Prio4 <br>- 10% of ingress port-channel link- Background Flow[Prio0, 1, and 2]                                                                                                                                    | - Single LC - Multiple ASIC <br>- Multiple LC  | 1. The lossless Prio3-4 traffic should not experience drop.<br>2. Ensure that background flows experience drop.<br>3. DUT sends PFCs to traffic generator to rate-limit the lossless prio traffic.                                                                                                                                                                                                                                                                                            | 
|           02 | TEST CONGESTION DETECTION ON PORT FAILURE ON PORTCHANNEL WITH MACSEC ENABLED:<br>Test case to verify that DUT detects congestion on egress port-channel link on port-failure with MACSEC enabled on port-channel.                              | - Two x 100Gbps ingress and two x 100Gbps egress port with MACSEC and PFC-WD enabled.<br>- Repeat with 2x400Gbps ingress and egress ports as port-channel members. <br>- 1024B packet-size. | - 90% - Lossless Prio3 & Prio4<br>- 10% - Lossy Background Flow[Prio0, 1, and 2]<br>- Shutdown one of the egress ports.<br>- Shutting one of egress port causing congestion on other egress port.<br>- Bring back the egress port online again <br> Repeat in loop. | - Single LC - Multiple ASIC<br>Multiple LC     | 1. Line-rate should be 200Gbps without any PFCs or packet drops. <br>2. When one of egress ports is shut,  PFCs should be sent to the ingress to slow down the incoming traffic.<br>3. The other egress port should receive all the Lossless Prio3 and Prio4 traffic.<br>4. Miniscule drop for both lossless and lossy traffic while traffic is shifting to other egress port. <br> 5. When egress port is back-online, the traffic on egress ports should switch back with no loss or drops. |


